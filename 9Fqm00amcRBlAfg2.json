{
  "active": false,
  "connections": {
    "When called by another workflow": {
      "main": [
        [
          {
            "node": "G√©n√©rer HTML complet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-11-02T15:48:03.237Z",
  "id": "9Fqm00amcRBlAfg2",
  "isArchived": false,
  "meta": null,
  "name": "[SEO] Formatage rapport HTML",
  "nodes": [
    {
      "parameters": {},
      "id": "6413b8c8-c7bc-46a0-bf9a-66aab1cc3265",
      "name": "When called by another workflow",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        224,
        -288
      ]
    },
    {
      "parameters": {
        "functionCode": "const items = $input.all();\n\n// Item 0 = donn√©es m√©triques\nconst data = items[0].json;\n\n// Items 1-5 = analyses IA\nconst analyses = {};\nitems.slice(1).forEach(item => {\n  const type = item.json.type;\n  analyses[type] = item.json.analysis;\n});\n\nconst globalAnalysis = analyses.global || 'Non disponible';\nconst decliningAnalysis = analyses.declining_pages || 'Non disponible';\nconst ctrAnalysis = analyses.ctr_opportunities || 'Non disponible';\nconst contentAnalysis = analyses.content_strategy || 'Non disponible';\nconst deviceAnalysis = analyses.device_analysis || 'Non disponible';\n\nconst html = `\n<!DOCTYPE html>\n<html lang=\"fr\">\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Rapport SEO hebdomadaire - ${data.siteUrl}</title>\n  <style>\n    * { margin: 0; padding: 0; box-sizing: border-box; }\n    body { \n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n      line-height: 1.6; \n      color: #2c3e50; \n      background: #f5f7fa;\n      padding: 20px;\n    }\n    .container { \n      max-width: 1200px;\n      margin: 0 auto;\n      background: white; \n      border-radius: 12px; \n      padding: 40px; \n      margin-bottom: 30px; \n      box-shadow: 0 4px 20px rgba(0,0,0,0.08);\n    }\n    h1 { \n      color: #1a202c;\n      font-size: 36px;\n      margin-bottom: 10px;\n      font-weight: 700;\n    }\n    h2 { \n      color: #2d3748;\n      margin: 40px 0 20px 0;\n      padding-bottom: 12px;\n      border-bottom: 3px solid #4CAF50;\n      font-size: 28px;\n      font-weight: 600;\n      display: flex;\n      align-items: center;\n    }\n    h2::before { \n      content: '';\n      display: inline-block;\n      width: 5px;\n      height: 28px;\n      background: #4CAF50;\n      margin-right: 15px;\n      border-radius: 3px;\n    }\n    h3 { \n      color: #4a5568;\n      font-size: 20px;\n      margin: 30px 0 15px 0;\n      font-weight: 600;\n    }\n    .header-info {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 30px;\n      border-radius: 12px;\n      margin-bottom: 30px;\n    }\n    .header-info h1 { color: white; }\n    .period { \n      color: rgba(255,255,255,0.9);\n      font-size: 16px;\n      margin: 10px 0;\n      font-weight: 500;\n    }\n    .metrics-grid { \n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));\n      gap: 20px;\n      margin: 30px 0;\n    }\n    .metric { \n      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);\n      border-radius: 12px;\n      padding: 24px;\n      border-left: 5px solid #4CAF50;\n      transition: transform 0.2s, box-shadow 0.2s;\n    }\n    .metric:hover {\n      transform: translateY(-5px);\n      box-shadow: 0 8px 25px rgba(0,0,0,0.1);\n    }\n    .metric-value { \n      font-size: 36px;\n      font-weight: 700;\n      color: #2c3e50;\n      margin: 12px 0;\n      font-variant-numeric: tabular-nums;\n    }\n    .metric-label { \n      font-size: 13px;\n      color: #718096;\n      text-transform: uppercase;\n      font-weight: 600;\n      letter-spacing: 1px;\n    }\n    .variation { \n      font-size: 18px;\n      font-weight: 700;\n      margin-top: 10px;\n      display: flex;\n      align-items: center;\n      gap: 5px;\n    }\n    .positive { color: #27ae60; }\n    .negative { color: #e74c3c; }\n    .neutral { color: #95a5a6; }\n    table { \n      width: 100%;\n      border-collapse: collapse;\n      margin: 25px 0;\n      font-size: 15px;\n      box-shadow: 0 2px 15px rgba(0,0,0,0.05);\n      border-radius: 8px;\n      overflow: hidden;\n    }\n    th { \n      background: #34495e;\n      color: white;\n      padding: 16px 12px;\n      text-align: left;\n      font-weight: 600;\n      font-size: 14px;\n      text-transform: uppercase;\n      letter-spacing: 0.5px;\n    }\n    td { \n      padding: 14px 12px;\n      border-bottom: 1px solid #e2e8f0;\n    }\n    tr:hover { \n      background: #f7fafc;\n    }\n    tr:nth-child(even) { \n      background: #fafafa;\n    }\n    tr:nth-child(even):hover { \n      background: #f7fafc;\n    }\n    .alert { \n      background: #fff3cd;\n      border-left: 5px solid #ffc107;\n      padding: 20px;\n      margin: 20px 0;\n      border-radius: 8px;\n      box-shadow: 0 2px 10px rgba(255,193,7,0.1);\n    }\n    .alert-danger { \n      background: #f8d7da;\n      border-left-color: #dc3545;\n      box-shadow: 0 2px 10px rgba(220,53,69,0.1);\n    }\n    .alert h3 {\n      margin-top: 0;\n      color: #856404;\n    }\n    .alert-danger h3 {\n      color: #721c24;\n    }\n    .alert p {\n      margin: 8px 0;\n      font-weight: 500;\n    }\n    .ai-section { \n      background: linear-gradient(135deg, #e3f2fd 0%, #f0f7ff 100%);\n      border-left: 5px solid #2196F3;\n      padding: 25px;\n      margin: 25px 0;\n      border-radius: 8px;\n      box-shadow: 0 2px 15px rgba(33,150,243,0.1);\n    }\n    .ai-section h3 { \n      color: #1976D2;\n      margin-top: 0;\n      display: flex;\n      align-items: center;\n      gap: 10px;\n    }\n    .ai-content { \n      white-space: pre-wrap;\n      line-height: 1.9;\n      color: #37474f;\n    }\n    .badge { \n      display: inline-block;\n      padding: 6px 14px;\n      border-radius: 20px;\n      font-size: 13px;\n      font-weight: 600;\n      margin-right: 10px;\n      margin-bottom: 10px;\n    }\n    .badge-success { background: #d4edda; color: #155724; }\n    .badge-warning { background: #fff3cd; color: #856404; }\n    .badge-danger { background: #f8d7da; color: #721c24; }\n    .badge-info { background: #d1ecf1; color: #0c5460; }\n    a { \n      color: #2196F3;\n      text-decoration: none;\n      transition: color 0.2s;\n    }\n    a:hover { \n      color: #1976D2;\n      text-decoration: underline;\n    }\n    .footer {\n      margin-top: 50px;\n      padding-top: 25px;\n      border-top: 2px solid #e2e8f0;\n      color: #718096;\n      font-size: 13px;\n      text-align: center;\n    }\n    .section-intro {\n      color: #4a5568;\n      font-size: 16px;\n      margin-bottom: 20px;\n      line-height: 1.7;\n    }\n    @media print {\n      body { background: white; padding: 0; }\n      .container { box-shadow: none; padding: 20px; }\n      .metric:hover { transform: none; }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header-info\">\n      <h1>üìä Rapport SEO hebdomadaire avec analyses IA</h1>\n      <p class=\"period\"><strong>P√©riode analys√©e :</strong> ${data.period.current}</p>\n      <p class=\"period\"><strong>Site :</strong> ${data.siteUrl}</p>\n      <p class=\"period\"><strong>Niche :</strong> ${data.siteNiche}</p>\n      <p class=\"period\"><strong>Rapport g√©n√©r√© le :</strong> ${new Date().toLocaleDateString('fr-FR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>\n    </div>\n    \n    ${data.alerts.length > 0 ? `\n      <div class=\"alert ${data.alerts.some(a => a.includes('ALERTE')) ? 'alert-danger' : ''}\">\n        <h3>üö® Alertes automatiques</h3>\n        ${data.alerts.map(alert => `<p><strong>${alert}</strong></p>`).join('')}\n      </div>\n    ` : ''}\n  </div>\n\n  <div class=\"container\">\n    <h2>üìà Vue d'ensemble</h2>\n    <p class=\"section-intro\">Comparaison entre ${data.period.current} et ${data.period.previous}</p>\n    \n    <div class=\"metrics-grid\">\n      <div class=\"metric\">\n        <div class=\"metric-label\">Clicks</div>\n        <div class=\"metric-value\">${data.global.current.clicks.toLocaleString('fr-FR')}</div>\n        <div class=\"variation ${parseFloat(data.global.variations.clicks) >= 0 ? 'positive' : 'negative'}\">\n          <span>${parseFloat(data.global.variations.clicks) >= 0 ? '‚Üó' : '‚Üò'}</span>\n          <span>${Math.abs(parseFloat(data.global.variations.clicks)).toFixed(1)}%</span>\n        </div>\n      </div>\n      <div class=\"metric\">\n        <div class=\"metric-label\">Impressions</div>\n        <div class=\"metric-value\">${data.global.current.impressions.toLocaleString('fr-FR')}</div>\n        <div class=\"variation ${parseFloat(data.global.variations.impressions) >= 0 ? 'positive' : 'negative'}\">\n          <span>${parseFloat(data.global.variations.impressions) >= 0 ? '‚Üó' : '‚Üò'}</span>\n          <span>${Math.abs(parseFloat(data.global.variations.impressions)).toFixed(1)}%</span>\n        </div>\n      </div>\n      <div class=\"metric\">\n        <div class=\"metric-label\">CTR moyen</div>\n        <div class=\"metric-value\">${data.global.current.ctr}%</div>\n        <div class=\"variation ${parseFloat(data.global.variations.ctr) >= 0 ? 'positive' : 'negative'}\">\n          <span>${parseFloat(data.global.variations.ctr) >= 0 ? '‚Üó' : '‚Üò'}</span>\n          <span>${Math.abs(parseFloat(data.global.variations.ctr)).toFixed(1)}%</span>\n        </div>\n      </div>\n      <div class=\"metric\">\n        <div class=\"metric-label\">Position moyenne</div>\n        <div class=\"metric-value\">${data.global.current.position}</div>\n        <div class=\"variation ${parseFloat(data.global.variations.position) <= 0 ? 'positive' : 'negative'}\">\n          <span>${parseFloat(data.global.variations.position) <= 0 ? '‚Üó' : '‚Üò'}</span>\n          <span>${Math.abs(parseFloat(data.global.variations.position)).toFixed(1)}</span>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"container\">\n    <div class=\"ai-section\">\n      <h2 style=\"border: none; padding: 0; margin: 0;\">ü§ñ Analyse strat√©gique IA</h2>\n      <div class=\"ai-content\">${globalAnalysis.replace(/\\n/g, '<br>')}</div>\n    </div>\n  </div>\n\n  <div class=\"container\">\n    <h2>üì± Performance par device</h2>\n    <table>\n      <thead>\n        <tr>\n          <th>Device</th>\n          <th>Clicks</th>\n          <th>Variation</th>\n          <th>Impressions</th>\n          <th>CTR</th>\n          <th>Position</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${data.deviceBreakdown.map(d => `\n          <tr>\n            <td><strong>${d.device.toUpperCase()}</strong></td>\n            <td>${d.clicks.toLocaleString('fr-FR')}</td>\n            <td class=\"${d.clicksVariation >= 0 ? 'positive' : 'negative'}\">\n              <strong>${d.clicksVariation >= 0 ? '‚Üó' : '‚Üò'} ${Math.abs(d.clicksVariation).toFixed(1)}%</strong>\n            </td>\n            <td>${d.impressions.toLocaleString('fr-FR')}</td>\n            <td>${d.ctr.toFixed(2)}%</td>\n            <td>${d.position.toFixed(1)}</td>\n          </tr>\n        `).join('')}\n      </tbody>\n    </table>\n    \n    <div class=\"ai-section\">\n      <h3>ü§ñ Recommandations IA par device</h3>\n      <div class=\"ai-content\">${deviceAnalysis.replace(/\\n/g, '<br>')}</div>\n    </div>\n  </div>\n\n  ${data.pagesInDecline.length > 0 ? `\n    <div class=\"container\">\n      <h2>‚ö†Ô∏è Pages en forte baisse</h2>\n      <p class=\"section-intro\">\n        <span class=\"badge badge-danger\">${data.pagesInDecline.length} page(s)</span>\n        ont perdu plus de 50% de leurs clicks\n      </p>\n      <table>\n        <thead>\n          <tr>\n            <th>Page</th>\n            <th>Clicks actuels</th>\n            <th>Clicks pr√©c√©dents</th>\n            <th>Baisse</th>\n            <th>Position</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${data.pagesInDecline.slice(0, 15).map(p => `\n            <tr>\n              <td><a href=\"${p.page}\" target=\"_blank\">${p.page.length > 70 ? p.page.substring(0, 70) + '...' : p.page}</a></td>\n              <td>${p.clicks}</td>\n              <td>${p.clicksPrevious || 0}</td>\n              <td class=\"negative\"><strong>${p.clicksVariation.toFixed(0)}%</strong></td>\n              <td>${p.position.toFixed(1)}</td>\n            </tr>\n          `).join('')}\n        </tbody>\n      </table>\n      \n      <div class=\"ai-section\">\n        <h3>ü§ñ Diagnostic IA et plan de r√©cup√©ration</h3>\n        <div class=\"ai-content\">${decliningAnalysis.replace(/\\n/g, '<br>')}</div>\n      </div>\n    </div>\n  ` : ''}\n\n  ${data.lowCTROpportunities.length > 0 ? `\n    <div class=\"container\">\n      <h2>üí° Opportunit√©s CTR</h2>\n      <p class=\"section-intro\">\n        <span class=\"badge badge-warning\">${data.lowCTROpportunities.length} requ√™te(s)</span>\n        avec beaucoup d'impressions mais un CTR faible (&lt;2%)\n      </p>\n      <table>\n        <thead>\n          <tr>\n            <th>Requ√™te</th>\n            <th>Impressions</th>\n            <th>Clicks</th>\n            <th>CTR actuel</th>\n            <th>Position</th>\n            <th>Potentiel</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${data.lowCTROpportunities.slice(0, 15).map(q => {\n            const expectedCTR = q.position < 3 ? 25 : q.position < 5 ? 15 : q.position < 10 ? 8 : 3;\n            const potentialClicks = Math.round(q.impressions * expectedCTR / 100);\n            const gain = potentialClicks - q.clicks;\n            return `\n            <tr>\n              <td><strong>${q.query}</strong></td>\n              <td>${q.impressions.toLocaleString('fr-FR')}</td>\n              <td>${q.clicks}</td>\n              <td class=\"negative\">${q.ctr.toFixed(2)}%</td>\n              <td>${q.position.toFixed(1)}</td>\n              <td class=\"positive\"><strong>+${gain} clicks</strong></td>\n            </tr>\n          `}).join('')}\n        </tbody>\n      </table>\n      \n      <div class=\"ai-section\">\n        <h3>ü§ñ Recommandations IA pour booster le CTR</h3>\n        <div class=\"ai-content\">${ctrAnalysis.replace(/\\n/g, '<br>')}</div>\n      </div>\n    </div>\n  ` : ''}\n\n  ${data.newWinners.length > 0 || data.positionLosers.length > 0 ? `\n    <div class=\"container\">\n      <h2>üéØ Strat√©gie de contenu</h2>\n      \n      ${data.newWinners.length > 0 ? `\n        <h3>üöÄ Nouvelles requ√™tes qui explosent (+200%)</h3>\n        <table>\n          <thead>\n            <tr>\n              <th>Requ√™te</th>\n              <th>Clicks</th>\n              <th>Progression</th>\n              <th>Position</th>\n              <th>Impressions</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${data.newWinners.slice(0, 15).map(q => `\n              <tr>\n                <td><strong>${q.query}</strong></td>\n                <td>${q.clicks}</td>\n                <td class=\"positive\"><strong>+${q.clicksVariation.toFixed(0)}%</strong></td>\n                <td>${q.position.toFixed(1)}</td>\n                <td>${q.impressions.toLocaleString('fr-FR')}</td>\n              </tr>\n            `).join('')}\n          </tbody>\n        </table>\n      ` : ''}\n      \n      ${data.positionLosers.length > 0 ? `\n        <h3>üìâ Requ√™tes qui perdent des positions</h3>\n        <table>\n          <thead>\n            <tr>\n              <th>Requ√™te</th>\n              <th>Clicks</th>\n              <th>Position actuelle</th>\n              <th>Position pr√©c√©dente</th>\n              <th>Perte</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${data.positionLosers.slice(0, 15).map(q => `\n              <tr>\n                <td><strong>${q.query}</strong></td>\n                <td>${q.clicks}</td>\n                <td class=\"negative\">${q.position.toFixed(1)}</td>\n                <td>${q.positionPrevious.toFixed(1)}</td>\n                <td class=\"negative\"><strong>-${Math.abs(q.positionVariation).toFixed(1)}</strong></td>\n              </tr>\n            `).join('')}\n          </tbody>\n        </table>\n      ` : ''}\n      \n      <div class=\"ai-section\">\n        <h3>ü§ñ Recommandations strat√©giques IA</h3>\n        <div class=\"ai-content\">${contentAnalysis.replace(/\\n/g, '<br>')}</div>\n      </div>\n    </div>\n  ` : ''}\n\n  <div class=\"container\">\n    <h2>üîù Top 20 pages de la semaine</h2>\n    <table>\n      <thead>\n        <tr>\n          <th style=\"width: 40px;\">#</th>\n          <th>Page</th>\n          <th>Clicks</th>\n          <th>Var.</th>\n          <th>Impressions</th>\n          <th>CTR</th>\n          <th>Position</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${data.topPages.slice(0, 20).map((p, i) => `\n          <tr>\n            <td style=\"text-align: center;\"><strong>${i + 1}</strong></td>\n            <td><a href=\"${p.page}\" target=\"_blank\">${p.page.length > 60 ? p.page.substring(0, 60) + '...' : p.page}</a></td>\n            <td><strong>${p.clicks}</strong></td>\n            <td class=\"${p.clicksVariation >= 0 ? 'positive' : 'negative'}\">${p.clicksVariation.toFixed(0)}%</td>\n            <td>${p.impressions.toLocaleString('fr-FR')}</td>\n            <td>${p.ctr.toFixed(2)}%</td>\n            <td>${p.position.toFixed(1)}</td>\n          </tr>\n        `).join('')}\n      </tbody>\n    </table>\n  </div>\n\n  <div class=\"container\">\n    <h2>üîç Top 30 requ√™tes de la semaine</h2>\n    <table>\n      <thead>\n        <tr>\n          <th style=\"width: 40px;\">#</th>\n          <th>Requ√™te</th>\n          <th>Clicks</th>\n          <th>Var.</th>\n          <th>Impressions</th>\n          <th>CTR</th>\n          <th>Position</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${data.topQueries.slice(0, 30).map((q, i) => `\n          <tr>\n            <td style=\"text-align: center;\"><strong>${i + 1}</strong></td>\n            <td><strong>${q.query}</strong></td>\n            <td><strong>${q.clicks}</strong></td>\n            <td class=\"${q.clicksVariation >= 0 ? 'positive' : 'negative'}\">${q.clicksVariation.toFixed(0)}%</td>\n            <td>${q.impressions.toLocaleString('fr-FR')}</td>\n            <td>${q.ctr.toFixed(2)}%</td>\n            <td>${q.position.toFixed(1)}</td>\n          </tr>\n        `).join('')}\n      </tbody>\n    </table>\n  </div>\n\n  <div class=\"footer\">\n    <p><strong>Rapport SEO automatis√© avec analyses IA</strong></p>\n    <p>G√©n√©r√© le ${new Date().toLocaleDateString('fr-FR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</p>\n    <p>Propuls√© par n8n + Claude AI + Google Search Console</p>\n  </div>\n</body>\n</html>\n`;\n\nreturn [{\n  json: {\n    html: html,\n    subject: `üìä Rapport SEO hebdo : ${data.global.current.clicks.toLocaleString('fr-FR')} clicks (${data.global.variations.clicks}%) - ${data.siteNiche}`,\n    data: data,\n    analyses: analyses\n  }\n}];"
      },
      "id": "aaa5df52-7948-4c60-b4fb-0247a9ee56d1",
      "name": "G√©n√©rer HTML complet",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        432,
        -288
      ]
    }
  ],
  "origin": "n8n",
  "pinData": {},
  "repo": {
    "owner": "kamiyechung",
    "name": "Sauvegarde-n8n"
  },
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-11-02T15:48:03.237Z",
      "updatedAt": "2025-11-02T15:48:03.237Z",
      "role": "workflow:owner",
      "workflowId": "9Fqm00amcRBlAfg2",
      "projectId": "oALk376RbKlV8lOt"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-11-02T15:48:03.380Z",
  "versionId": "6ec19737-e98e-4aed-ba91-5af0f5ad9d3f"
}