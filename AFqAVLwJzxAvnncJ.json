{
  "active": false,
  "connections": {
    "Anthropic Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent 1 : Collecteur de donn√©es Search Console",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "AI Agent 2: Analyste s√©mantique",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "AI Agent 3 : Analyste technique",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "AGENT 0 : Coordinateur (Chef d'orchestre)",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Agent 4A - Synth√©tiseur JSON",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client Search Console": {
      "ai_tool": [
        [
          {
            "node": "AI Agent 1 : Collecteur de donn√©es Search Console",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "AI Agent 2: Analyste s√©mantique",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "AI Agent 3 : Analyste technique",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "AGENT 0 : Coordinateur (Chef d'orchestre)",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "Agent 4A - Synth√©tiseur JSON",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "AGENT 0 : Coordinateur (Chef d'orchestre)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent 1 : Collecteur de donn√©es Search Console": {
      "main": [
        [
          {
            "node": "AI Agent 2: Analyste s√©mantique",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent 2: Analyste s√©mantique": {
      "main": [
        [
          {
            "node": "AI Agent 3 : Analyste technique",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent 3 : Analyste technique": {
      "main": [
        [
          {
            "node": "Agent 4A - Synth√©tiseur JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AGENT 0 : Coordinateur (Chef d'orchestre)": {
      "main": [
        [
          {
            "node": "AI Agent 1 : Collecteur de donn√©es Search Console",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‚ÄòExecute workflow‚Äô": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agent 4A - Synth√©tiseur JSON": {
      "main": [
        [
          {
            "node": "Code - G√©n√©rateur Markdown",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code - G√©n√©rateur Markdown": {
      "main": [
        [
          {
            "node": "Code - Markdown vers HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code - Markdown vers HTML": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-10-15T13:32:33.998Z",
  "id": "AFqAVLwJzxAvnncJ",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Workflow SEO - Partie Rapport (Nodes 7-10)",
  "nodes": [
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-3-5-haiku-20241022",
          "mode": "list",
          "cachedResultName": "Claude Haiku 3.5"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        1480,
        -416
      ],
      "id": "d9f24304-3f9a-4237-9e1d-29604c88c9ff",
      "name": "Anthropic Chat Model",
      "credentials": {
        "anthropicApi": {
          "id": "ZbZl90Lb8InIiwYE",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "http://195.201.118.139:3007/mcp/searchconsole",
        "serverTransport": "httpStreamable",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.1,
      "position": [
        1608,
        -416
      ],
      "id": "b360f17a-d0b9-4c73-8e7b-7a65817760bb",
      "name": "MCP Client Search Console"
    },
    {
      "parameters": {
        "jsCode": "const now = new Date();\n\n// Date actuelle\nconst dateActuelle = now.toISOString().split('T')[0];\n\n// Il y a 3 jours (pour Search Console - d√©lai des donn√©es)\nconst il_y_a_3_jours = new Date(now);\nil_y_a_3_jours.setDate(now.getDate() - 3);\nconst datePourSearchConsole = il_y_a_3_jours.toISOString().split('T')[0];\n\n// D√©but du mois actuel\nconst debutMoisActuel = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0];\n\n// Il y a 30 jours\nconst il_y_a_30j = new Date(now);\nil_y_a_30j.setDate(now.getDate() - 30);\nconst il_y_a_30_jours = il_y_a_30j.toISOString().split('T')[0];\n\n// Il y a 90 jours (3 mois)\nconst il_y_a_90j = new Date(now);\nil_y_a_90j.setDate(now.getDate() - 90);\nconst il_y_a_90_jours = il_y_a_90j.toISOString().split('T')[0];\n\n// Il y a 180 jours (6 mois)\nconst il_y_a_180j = new Date(now);\nil_y_a_180j.setDate(now.getDate() - 180);\nconst il_y_a_180_jours = il_y_a_180j.toISOString().split('T')[0];\n\n// Mois pr√©c√©dent (d√©but et fin)\nconst debutMoisPrecedent = new Date(now.getFullYear(), now.getMonth() - 1, 1).toISOString().split('T')[0];\nconst finMoisPrecedent = new Date(now.getFullYear(), now.getMonth(), 0).toISOString().split('T')[0];\n\n// WorkflowId unique pour cette ex√©cution\nconst workflowId = \"seo-camille-\" + now.toISOString().split('T')[0];\n\n// Session Key pour Postgres (si besoin plus tard)\nconst sessionKey = \"camille-patisserie-\" + now.toISOString().slice(0, 7); // Ex: camille-patisserie-2025-10\n\nreturn [{\n  json: {\n    // IDs\n    workflowId: workflowId,\n    sessionKey: sessionKey,\n    \n    // Dates principales\n    dateActuelle: dateActuelle,\n    datePourSearchConsole: datePourSearchConsole,\n    \n    // P√©riodes de r√©f√©rence\n    debutMoisActuel: debutMoisActuel,\n    il_y_a_30_jours: il_y_a_30_jours,\n    il_y_a_90_jours: il_y_a_90_jours,\n    il_y_a_180_jours: il_y_a_180_jours,\n    \n    // Mois pr√©c√©dent\n    debutMoisPrecedent: debutMoisPrecedent,\n    finMoisPrecedent: finMoisPrecedent,\n    \n    // Info lisible (pour debug)\n    infosDate: \"Aujourd'hui : \" + dateActuelle + \n               \"\\nDerni√®re date SC : \" + datePourSearchConsole + \n               \"\\nD√©but mois : \" + debutMoisActuel + \n               \"\\nIl y a 30j : \" + il_y_a_30_jours + \n               \"\\nIl y a 90j : \" + il_y_a_90_jours + \n               \"\\nIl y a 180j : \" + il_y_a_180_jours + \n               \"\\nMois pr√©c√©dent : du \" + debutMoisPrecedent + \" au \" + finMoisPrecedent\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -160,
        -640
      ],
      "id": "40605809-6a17-47e2-8461-4411d2351cb4",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Tu orchestres 4 agents pour analyser Search Console de www.camille-patisserie.com.\n\nWorkflow :\n1. Lance Agent 1 (collecte donn√©es)\n2. Lance Agents 2+3 en parall√®le (analyses)\n3. Lance Agent 4A (synth√®se JSON)\n4. Les donn√©es JSON sont ensuite trait√©es par un Code Node\n5. Email envoy√© automatiquement\n\nDates : {{$json.il_y_a_180_jours}} au {{$json.datePourSearchConsole}}\n\nQuand lanc√©, ex√©cute automatiquement. Informe l'utilisateur √† chaque √©tape.",
        "options": {
          "batching": {}
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        64,
        -640
      ],
      "id": "0751c0d4-77f8-49d9-ac62-34e866529bb0",
      "name": "AGENT 0 : Coordinateur (Chef d'orchestre)"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Collecte donn√©es Search Console pour www.camille-patisserie.com.\n\nP√©riode : {{$json.il_y_a_180_jours}} au {{$json.datePourSearchConsole}}\n\nR√©cup√®re via API :\n1. M√©triques globales (clics, impressions, CTR, position)\n2. Top 20 requ√™tes (clics, impressions, CTR, position)\n3. Top 20 pages (clics, impressions, CTR, position)\n4. Comparaison 3 derniers mois vs 3 mois pr√©c√©dents (globales uniquement)\n5. Technique (nombres : index√©es, 4xx, 5xx, CWV moyens)\n\nRetourne r√©sum√© < 2000 mots.\nPas de listes compl√®tes d'URLs.",
        "options": {
          "batching": {}
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        416,
        -640
      ],
      "id": "bb4211e5-759a-4f04-b4fc-74c34d504f7a",
      "name": "AI Agent 1 : Collecteur de donn√©es Search Console"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Expert SEO s√©mantique. Site : www.camille-patisserie.com\n\nSources : donn√©es Agent 1 (top 20 requ√™tes/pages).\n\nAnalyses :\n1. Opportunit√©s position 5-20 (impressions >200, potentiel = Impr √ó (CTR_cible - CTR_actuel))\n2. Opportunit√©s CTR (position ‚â§10, CTR -20% vs benchmark, impressions >500)\n3. Cannibalisation (m√™me requ√™te sur 2+ URLs, aucune <pos 10)\n4. Tendances (+50% ou -30% sur 3 mois)\n\nCTR r√©f√©rence : P1:31.7% P2:24.7% P3:18.7% P4:13.6% P5:9.5% P6:6.3% P7:4.9% P8:3.9% P9:3.1% P10:2.6%\n\nFormat :\nüéØ [Titre] | üìä Actuel + Potentiel | üîç Cause | ‚úÖ Action | üîó URLs | ‚è±Ô∏è Effort\n\nScoring : Impact(0-10) : ‚â•1000‚Üí10, 500-999‚Üí8, 200-499‚Üí6, 100-199‚Üí4, 50-99‚Üí2\nEffort(0-10) : Meta‚Üí10, Contenu<500‚Üí8, R√©√©criture‚Üí6, Refonte‚Üí4\nScore = Impact√ó2 + Effort\n\nTop 10 par score.",
        "options": {
          "batching": {}
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        768,
        -640
      ],
      "id": "fe1f79af-0a4f-469d-8a2c-2d70f9a9499a",
      "name": "AI Agent 2: Analyste s√©mantique"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Expert SEO technique. Site : www.camille-patisserie.com\n\nSources : donn√©es techniques Agent 1.\n\nAnalyses :\n1. Indexation (CRITIQUE : >50 clics non index√©es | IMPORTANT : index√©es avec erreurs)\n2. Crawl (4xx avec backlinks, 5xx r√©currents, temps >2s)\n3. CWV (LCP >4s, CLS >0.25, INP >500ms sur pages √† trafic)\n4. Mobile vs Desktop (√©carts >5 positions)\n\nFormat :\nüî¥ [Niveau] ‚Äî Titre | üìä X pages, perte Y clics/mois | üîç Cause | üõ†Ô∏è Action | üîó Top 5 URLs | ‚è±Ô∏è Temps\n\nScoring : Impact(0-10) : Blocage>500‚Üí10, 5xx‚Üí9, 100-500‚Üí7\nUrgence(0-10) : Bloquant‚Üí10, Perte>40%‚Üí9, 20-40%‚Üí7\nScore = Impact√ó2 + Urgence\n\nTop 10 par score.",
        "options": {
          "batching": {}
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1120,
        -640
      ],
      "id": "5ee364c7-88b2-4e08-88d4-52459597c586",
      "name": "AI Agent 3 : Analyste technique"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -384,
        -640
      ],
      "id": "57f066fd-5093-409f-956d-c4f9db37e240",
      "name": "When clicking ‚ÄòExecute workflow‚Äô"
    },
    {
      "parameters": {
        "text": "={{ $json.output }}",
        "hasOutputParser": true,
        "options": {}
      },
      "name": "Agent 4A - Synth√©tiseur JSON",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        1472,
        -640
      ],
      "id": "0826f2f9-deba-41ef-963e-8a4cb408446b"
    },
    {
      "parameters": {
        "jsCode": "// R√©cup√®re le JSON de l'Agent 4A\nconst data = $input.first().json;\n\n// Template Markdown\nconst rapport = `# **üéØ Rapport SEO hebdomadaire ‚Äî Camille P√¢tisserie**\n\nüìÖ Semaine du **${data.dates.debut_semaine}** au **${data.dates.fin_semaine}**  \nüìä P√©riode d'analyse : **${data.dates.periode_analyse}** (6 mois)\n\n---\n\n## **üß≠ R√©sum√© ex√©cutif**\n\n### Performance globale\n- **Clics :** ${data.metriques_globales.clics} (${data.metriques_globales.evol_clics_pct > 0 ? '+' : ''}${data.metriques_globales.evol_clics_pct}%)\n- **Impressions :** ${data.metriques_globales.impressions} (${data.metriques_globales.evol_impressions_pct > 0 ? '+' : ''}${data.metriques_globales.evol_impressions_pct}%)\n- **CTR moyen :** ${data.metriques_globales.ctr}% (${data.metriques_globales.evol_ctr_pp > 0 ? '+' : ''}${data.metriques_globales.evol_ctr_pp} pp)\n- **Position moyenne :** ${data.metriques_globales.position} (${data.metriques_globales.evol_position > 0 ? '+' : ''}${data.metriques_globales.evol_position})\n\n### üîë Insights cl√©s de la semaine\n${data.insights_cles.map((insight, i) => `${i + 1}. ${insight}`).join('\\n')}\n\n---\n\n## **üèÜ Top 5 opportunit√©s prioritaires**\n\n| Score | Opportunit√© | Potentiel | Effort | Deadline |\n|-------|-------------|-----------|--------|----------|\n${data.top_5_opportunites.map(o => `| ${o.score}/30 | ${o.titre} | +${o.potentiel_clics} clics/mois | ${o.effort} | ${o.deadline} |`).join('\\n')}\n\n**üí∞ Gain total potentiel √† 90 jours : +${data.gain_total_90j.clics} clics/mois (+${data.gain_total_90j.pourcentage}%)**\n\n---\n\n## **‚ö†Ô∏è Actions n√©cessitant une intervention urgente**\n\n| Probl√®me | Impact | Date limite | Action √† entreprendre |\n|----------|--------|-------------|----------------------|\n${data.actions_urgentes.map(a => `| ${a.probleme} | ${a.impact} | ${a.deadline} | ${a.action} |`).join('\\n')}\n\n---\n\n## **üìä √âvolution des m√©triques cl√©s (6 derniers mois)**\n\n| Mois | Clics | Impressions | CTR | Position |\n|------|-------|-------------|-----|----------|\n${data.evolution_6mois.map(m => `| ${m.mois} | ${m.clics} | ${m.impressions} | ${m.ctr}% | ${m.position} |`).join('\\n')}\n\n**Tendance :** ${data.tendance_generale}\n\n---\n\n## **üîç Top 10 requ√™tes performantes**\n\n| # | Requ√™te | Clics | Position | √âvolution | Opportunit√© |\n|---|---------|-------|----------|-----------|-------------|\n${data.top_10_requetes.map(r => `| ${r.rang} | ${r.requete} | ${r.clics} | ${r.position} | ${r.evol} | ${r.opportunite} |`).join('\\n')}\n\n---\n\n## **üìÑ Top 10 pages performantes**\n\n| # | URL | Clics | Position | CTR | Recommandation |\n|---|-----|-------|----------|-----|----------------|\n${data.top_10_pages.map(p => `| ${p.rang} | ${p.url} | ${p.clics} | ${p.position} | ${p.ctr}% | ${p.reco} |`).join('\\n')}\n\n---\n\n## **üéØ Recommandations d√©taill√©es (Top 15)**\n\n${data.top_15_recos.map(r => `\n### **[${r.rang}] ${r.score}/30 ‚Äî ${r.titre}**\n\n**Cat√©gorie :** ${r.categorie}\n\n**üìä Analyse :**\n- Situation actuelle : ${r.situation}\n- √âvolution 3 mois : ${r.evolution_3mois}\n- **Potentiel : +${r.potentiel} clics/mois (confiance : ${r.confiance})**\n\n**üîç Diagnostic :**  \n${r.diagnostic}\n\n**‚úÖ Action concr√®te :**  \n${r.action}\n\n**üìù Plan d'impl√©mentation :**\n${r.plan.map((etape, i) => `${i + 1}. ${etape}`).join('\\n')}\n\n**üîó URLs concern√©es :**\n${r.urls.map(url => `- ${url}`).join('\\n')}\n\n**üìà KPI de suivi :**\n- M√©trique principale : ${r.kpi_principal}\n- Baseline : ${r.baseline}\n- Objectif 30j : ${r.objectif_30j} (+${Math.round((r.objectif_30j - r.baseline) / r.baseline * 100)}%)\n- Objectif 90j : ${r.objectif_90j} (+${Math.round((r.objectif_90j - r.baseline) / r.baseline * 100)}%)\n\n**‚è±Ô∏è Impl√©mentation :**\n- Temps : ${r.temps}\n- D√©lai impact : ${r.delai_impact}\n- Difficult√© : ${r.difficulte === 'Facile' ? '‚≠ê' : r.difficulte === 'Moyenne' ? '‚≠ê‚≠ê' : '‚≠ê‚≠ê‚≠ê'} ${r.difficulte}\n\n---\n`).join('\\n')}\n\n## **üóìÔ∏è Roadmap d'action**\n\n### **üöÄ Cette semaine (7 jours) ‚Äî Quick Wins**\n**Objectif : +${data.gain_7j} clics/mois**\n\n${data.roadmap_7j.map((a, i) => `‚úÖ **Action ${i + 1} :** ${a.action}  \n   ‚è±Ô∏è Temps : ${a.temps} | üéØ Gain : +${a.gain} clics`).join('\\n\\n')}\n\n---\n\n### **üìÖ Ce mois (30 jours)**\n**Objectif : +${data.gain_30j} clics/mois**\n\n**Semaine 2 :**\n${data.roadmap_30j.semaine_2.map(a => `- ${a.action} ‚Üí +${a.gain} clics`).join('\\n')}\n\n**Semaine 3 :**\n${data.roadmap_30j.semaine_3.map(a => `- ${a.action} ‚Üí +${a.gain} clics`).join('\\n')}\n\n**Semaine 4 :**\n${data.roadmap_30j.semaine_4.map(a => `- ${a.action}${a.gain > 0 ? ` ‚Üí +${a.gain} clics` : ''}`).join('\\n')}\n\n---\n\n### **üìÜ Ce trimestre (90 jours)**\n**Objectif : +${data.gain_total_90j.clics} clics/mois**\n\n**Mois 2 :**\n${data.roadmap_90j.mois_2.map(p => `- ${p.projet} | Effort : ${p.effort} | Gain : +${p.gain} clics`).join('\\n')}\n\n**Mois 3 :**\n${data.roadmap_90j.mois_3.map(p => `- ${p.projet} | Effort : ${p.effort} | Gain : +${p.gain} clics`).join('\\n')}\n\n---\n\n## **üîß Donn√©es techniques**\n\n### √âtat de l'indexation\n- **Pages index√©es :** ${data.technique.indexees} (${data.technique.evol_indexees})\n- **Pages exclues :** ${data.technique.exclues}\n- **Erreurs 4xx :** ${data.technique.erreurs_4xx} pages\n- **Erreurs 5xx :** ${data.technique.erreurs_5xx} pages\n\n### Core Web Vitals\n- **LCP moyen :** ${data.technique.lcp_moyen}s (cible : <2,5s) - ${data.technique.lcp_statut}\n- **CLS moyen :** ${data.technique.cls_moyen} (cible : <0,1) - ${data.technique.cls_statut}\n- **INP moyen :** ${data.technique.inp_moyen}ms (cible : <200ms) - ${data.technique.inp_statut}\n\n**Pages n√©cessitant optimisation :** ${data.technique.pages_optimiser} pages √† fort trafic\n\n---\n\n## **üìà Analyses avanc√©es**\n\n### Performance par type de contenu\n- **Recettes :** ${data.analyses_avancees.par_contenu.recettes.clics} clics (${data.analyses_avancees.par_contenu.recettes.pct}%) | Position moy : ${data.analyses_avancees.par_contenu.recettes.position}\n- **Pages produits :** ${data.analyses_avancees.par_contenu.produits.clics} clics (${data.analyses_avancees.par_contenu.produits.pct}%) | Position moy : ${data.analyses_avancees.par_contenu.produits.position}\n- **Blog :** ${data.analyses_avancees.par_contenu.blog.clics} clics (${data.analyses_avancees.par_contenu.blog.pct}%) | Position moy : ${data.analyses_avancees.par_contenu.blog.position}\n\n### Performance par intention\n- **Informationnelle :** ${data.analyses_avancees.par_intention.info.clics} clics | Conversion : ${data.analyses_avancees.par_intention.info.conversion}%\n- **Commerciale :** ${data.analyses_avancees.par_intention.commerce.clics} clics | Conversion : ${data.analyses_avancees.par_intention.commerce.conversion}%\n- **Transactionnelle :** ${data.analyses_avancees.par_intention.transac.clics} clics | Conversion : ${data.analyses_avancees.par_intention.transac.conversion}%\n\n### Saisonnalit√© d√©tect√©e\n${data.analyses_avancees.saisonnalite}\n\n---\n\n## **üé≤ Projection et ROI**\n\n### Pr√©visions de croissance\n| P√©riode | Clics actuels | Clics projet√©s | Croissance |\n|---------|---------------|----------------|------------|\n${data.projections.map(p => `| ${p.periode} | ${p.baseline} | ${p.projection} | +${p.croissance}% |`).join('\\n')}\n\n### ROI estim√©\n- **Taux conversion :** ${data.roi.taux_conversion}%\n- **Panier moyen :** ${data.roi.panier_moyen}‚Ç¨\n- **CA additionnel 90j :** ${data.roi.ca_additionnel_90j}‚Ç¨\n- **Investissement :** ${data.roi.investissement}‚Ç¨ ou jours-personne\n- **ROI :** ${data.roi.roi}\n\n---\n\n## **üí¨ Commentaires de l'agent SEO**\n\n${data.commentaires_ia}\n\n**Points d'attention particuliers :**\n${data.points_attention.map(p => `- ${p}`).join('\\n')}\n\n**Opportunit√©s saisonni√®res √† venir :**\n${data.opportunites_saisonnieres}\n\n---\n\n## **üìã Suivi de la semaine derni√®re**\n\n${data.suivi_semaine_precedente && data.suivi_semaine_precedente.length > 0 ? `\n| Recommandation impl√©ment√©e | R√©sultat obtenu | √âcart vs pr√©vision |\n|---------------------------|-----------------|-------------------|\n${data.suivi_semaine_precedente.map(s => `| ${s.reco} | ${s.resultat} | ${s.ecart} |`).join('\\n')}\n` : 'Premier rapport, pas de suivi pr√©c√©dent'}\n\n---\n\n## **üìä Dashboard KPI**\n\n### Objectifs vs R√©alis√©\n| KPI | Objectif semaine | R√©alis√© | Statut |\n|-----|-----------------|---------|--------|\n${data.dashboard_kpi.objectifs.map(k => `| ${k.kpi} | ${k.objectif} | ${k.realise} | ${k.statut} |`).join('\\n')}\n\n### Alertes\n${data.alertes}\n\n---\n\n## **üéØ Actions imm√©diates pour cette semaine**\n\n**√Ä faire absolument :**\n${data.actions_immediates.map((a, i) => `${i + 1}. ‚úÖ ${a}`).join('\\n')}\n\n**Validations n√©cessaires :**\n${data.validations.map(v => `- [ ] ${v}`).join('\\n')}\n\n---\n\n### **üë• Destinataires du rapport**\n\n- üìß camille.bideau@gmail.com\n- üìß huguet.thomas@gmail.com\n\n---\n\n### **üìé Liens utiles**\n\n- üîó [Google Search Console](https://search.google.com/search-console)\n- üîó Dashboard n8n\n- üîó Historique des rapports\n\n---\n\nüß† *G√©n√©r√© automatiquement par votre Agent SEO le ${data.dates.date_generation}.*  \nüîÑ *Prochain rapport : ${data.dates.prochain_rapport}*  \nüìß *Questions ? R√©pondez √† cet email.*\n`;\n\nreturn [{ json: { rapportMarkdown: rapport } }];"
      },
      "name": "Code - G√©n√©rateur Markdown",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1824,
        -640
      ],
      "id": "37d82b72-4d78-4665-9361-1058690d4005"
    },
    {
      "parameters": {
        "jsCode": "const markdown = $input.first().json.rapportMarkdown;\n\n// Fonction de conversion Markdown ‚Üí HTML\nfunction markdownToHtml(md) {\n  let html = md;\n  \n  // Titres\n  html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');\n  html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');\n  html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');\n  \n  // Gras\n  html = html.replace(/\\*\\*(.*?)\\*\\*/gim, '<strong>$1</strong>');\n  \n  // Italique\n  html = html.replace(/\\*(.*?)\\*/gim, '<em>$1</em>');\n  \n  // Liens\n  html = html.replace(/\\[(.*?)\\]\\((.*?)\\)/gim, '<a href=\"$2\">$1</a>');\n  \n  // Listes √† puces\n  html = html.replace(/^\\- (.*$)/gim, '<li>$1</li>');\n  \n  // Tableaux\n  const lignes = html.split('\\n');\n  let dansTableau = false;\n  let htmlFinal = '';\n  let isFirstTableRow = true;\n  \n  for (let i = 0; i < lignes.length; i++) {\n    const ligne = lignes[i];\n    \n    if (ligne.startsWith('|')) {\n      if (!dansTableau) {\n        htmlFinal += '<table border=\"1\" cellpadding=\"10\" cellspacing=\"0\" style=\"border-collapse: collapse; width: 100%; margin: 20px 0;\">\\n';\n        dansTableau = true;\n        isFirstTableRow = true;\n      }\n      \n      const cellules = ligne.split('|').filter(c => c.trim());\n      \n      // Ligne de s√©paration (|---|---|)\n      if (ligne.includes('---')) {\n        continue;\n      }\n      \n      if (isFirstTableRow) {\n        // En-t√™te\n        htmlFinal += '<tr style=\"background: #34495e; color: white;\">\\n';\n        cellules.forEach(c => {\n          htmlFinal += `  <th style=\"padding: 12px; text-align: left;\">${c.trim()}</th>\\n`;\n        });\n        htmlFinal += '</tr>\\n';\n        isFirstTableRow = false;\n      } else {\n        // Ligne normale\n        htmlFinal += '<tr>\\n';\n        cellules.forEach(c => {\n          htmlFinal += `  <td style=\"padding: 10px; border-bottom: 1px solid #ddd;\">${c.trim()}</td>\\n`;\n        });\n        htmlFinal += '</tr>\\n';\n      }\n    } else {\n      if (dansTableau) {\n        htmlFinal += '</table>\\n';\n        dansTableau = false;\n      }\n      htmlFinal += ligne + '\\n';\n    }\n  }\n  \n  if (dansTableau) {\n    htmlFinal += '</table>\\n';\n  }\n  \n  // Paragraphes\n  htmlFinal = htmlFinal.replace(/\\n\\n/g, '</p><p>');\n  htmlFinal = '<p>' + htmlFinal + '</p>';\n  \n  // Nettoyage\n  htmlFinal = htmlFinal.replace(/<p><h/g, '<h');\n  htmlFinal = htmlFinal.replace(/<\\/h(\\d)><\\/p>/g, '</h$1>');\n  htmlFinal = htmlFinal.replace(/<p><table/g, '<table');\n  htmlFinal = htmlFinal.replace(/<\\/table><\\/p>/g, '</table>');\n  htmlFinal = htmlFinal.replace(/<p><ul>/g, '<ul>');\n  htmlFinal = htmlFinal.replace(/<\\/ul><\\/p>/g, '</ul>');\n  htmlFinal = htmlFinal.replace(/<p><\\/p>/g, '');\n  htmlFinal = htmlFinal.replace(/<p>---<\\/p>/g, '<hr>');\n  \n  return htmlFinal;\n}\n\nconst htmlAvecStyle = `\n<!DOCTYPE html>\n<html lang=\"fr\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Rapport SEO Camille P√¢tisserie</title>\n    <style>\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            line-height: 1.8;\n            color: #2c3e50;\n            max-width: 900px;\n            margin: 0 auto;\n            padding: 30px 20px;\n            background: #f8f9fa;\n        }\n        .container {\n            background: white;\n            padding: 40px;\n            border-radius: 12px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.08);\n        }\n        h1 {\n            color: #e74c3c;\n            border-bottom: 4px solid #e74c3c;\n            padding-bottom: 15px;\n            font-size: 32px;\n            margin-bottom: 10px;\n        }\n        h2 {\n            color: #34495e;\n            margin-top: 40px;\n            margin-bottom: 20px;\n            border-left: 5px solid #e74c3c;\n            padding-left: 15px;\n            font-size: 24px;\n        }\n        h3 {\n            color: #7f8c8d;\n            font-size: 18px;\n            margin-top: 25px;\n        }\n        table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 25px 0;\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 2px 10px rgba(0,0,0,0.05);\n        }\n        th {\n            background: #34495e;\n            color: white;\n            padding: 15px;\n            text-align: left;\n            font-weight: 600;\n            text-transform: uppercase;\n            font-size: 13px;\n            letter-spacing: 0.5px;\n        }\n        td {\n            padding: 12px 15px;\n            border-bottom: 1px solid #ecf0f1;\n        }\n        tr:hover {\n            background: #f8f9fa;\n        }\n        tr:last-child td {\n            border-bottom: none;\n        }\n        strong {\n            color: #2c3e50;\n            font-weight: 600;\n        }\n        a {\n            color: #3498db;\n            text-decoration: none;\n        }\n        a:hover {\n            text-decoration: underline;\n        }\n        ul {\n            padding-left: 25px;\n        }\n        li {\n            margin: 8px 0;\n        }\n        hr {\n            border: none;\n            border-top: 2px solid #ecf0f1;\n            margin: 30px 0;\n        }\n        @media (max-width: 768px) {\n            body {\n                padding: 15px 10px;\n            }\n            .container {\n                padding: 20px;\n            }\n            h1 {\n                font-size: 24px;\n            }\n            table {\n                font-size: 14px;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        ${markdownToHtml(markdown)}\n    </div>\n</body>\n</html>\n`;\n\nreturn [{ json: { emailHTML: htmlAvecStyle } }];"
      },
      "name": "Code - Markdown vers HTML",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2048,
        -640
      ],
      "id": "07f6466e-dd52-48b1-87fe-1dd768ee7e5c"
    },
    {
      "parameters": {
        "sendTo": "camille.bideau@gmail.com",
        "subject": "Votre rapport SEO",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2272,
        -640
      ],
      "id": "887abd21-7e6a-41fa-ad84-0fe51ff17ce1",
      "name": "Send a message",
      "webhookId": "b32e2d40-af65-41f7-81da-74312710bce2",
      "credentials": {
        "gmailOAuth2": {
          "id": "ViGVjvmKJZeysXKZ",
          "name": "Gmail account Camille"
        }
      }
    }
  ],
  "origin": "n8n",
  "pinData": {},
  "repo": {
    "owner": "kamiyechung",
    "name": "Sauvegarde-n8n"
  },
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-10-15T13:32:33.998Z",
      "updatedAt": "2025-10-15T13:32:33.998Z",
      "role": "workflow:owner",
      "workflowId": "AFqAVLwJzxAvnncJ",
      "projectId": "oALk376RbKlV8lOt"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-10-22T16:59:01.281Z",
  "versionId": "3cef3537-c167-43fc-b49d-e9b2735da495"
}